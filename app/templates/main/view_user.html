{% extends "base.html" %}

{% from "macros/player_round_reached.html" import player_round_reached %}

{% block content %}

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">{{ _("profile_of", username=user.username) }}</h3>
    </div>

    <div class="panel-body">
        <div class="row">
            <div class="col-md-12">
                {% if user.get_participations().count() > 3 %}
                <div
                        id="ranking-chart"
                        class="chart"
                        style="margin-bottom: 20px;"
                ></div>
                {% endif %}

                <div class="table">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>{{ _("tournament") }}</th>
                            <th>{{ _("chosen_player") }}</th>
                            <th>{{ _("round_reached") }}</th>
                            <th>{{ _("points") }}</th>
                            <th>{{ _("atp_ranking") }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for participation in user.get_participations() %}
                        {% if not participation.tournament.is_open_to_registration() %}
                        <tr>
                            <td>
                                <a href="{{ url_for('tournament.view_tournament', tournament_id = participation.tournament.id, _external = True) }}">
                                    {{ participation.tournament.name }}
                                </a>
                            </td>
                            <td>
                                {{ participation.tournament_player.get_standard_name() }}
                            </td>
                            <td>{{ player_round_reached(participation.get_status()) }}</td>
                            <td>{{ participation.points }}</td>
                            <td>{{ participation.get_ranking() or "" }}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extrajs %}

<script src="http://code.highcharts.com/highcharts.js"></script>
<script>
  var series = {{ series | safe }}
  Highcharts.setOptions({
    lang: {
      months: ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'],
      weekdays: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
      shortMonths: ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Aout', 'Sept', 'Oct', 'Nov', 'Déc']
    }
  });
  $(document).ready(function () {
    $("#ranking-chart").highcharts({
      credits: { enabled: false },
      chart: {
        renderTo: "ranking-chart",
        type: "spline",
        height: 400
      },
      title: { text: "Historique du classement" },
      xAxis: { type: "datetime" },
      yAxis: {
        title: { text: "Classement" },
        reversed: true
      },
      tooltip: {
        formatter: function () {
          return this.point.tournament_name + " : <b>#" + this.point.y + "</b>"
        }
      },
      series: series,
      plotOptions: { spline: { marker: { enabled: true } } }
    });
  });
</script>

{% endblock extrajs %}
